{"ast":null,"code":"// /src/engine/battleEngine.js\n// Robust PvP-lite engine (never crashes on bad IDs). Returns:\n// { result:'p1'|'p2'|'draw'|'timeout', p1:{hp,shields,energy}, p2:{hp,shields,energy} }\n\nimport gamemaster from \"../Data/gamemaster.json\";\n\n/* ---------- normalization ---------- */\nfunction canonMoveId(s) {\n  return String(s || \"\").trim().replace(/^COMBAT_V\\d+_MOVE_/i, \"\").replace(/^V\\d+_/i, \"\").replace(/[^A-Za-z0-9]+/g, \"_\").replace(/_+/g, \"_\").replace(/^_|_$/g, \"\").toUpperCase();\n}\nfunction normSpecies(s) {\n  return String(s || \"\").toLowerCase().trim().replace(/[^a-z0-9]+/g, \"_\").replace(/^_+|_+$/g, \"\");\n}\nconst clamp = (v, lo, hi) => Math.max(lo, Math.min(hi, v));\n\n/* ---------- build data maps ---------- */\nconst MOVES = {};\n(function buildMoves(_gamemaster$data) {\n  const list = (gamemaster === null || gamemaster === void 0 ? void 0 : gamemaster.moves) || (gamemaster === null || gamemaster === void 0 ? void 0 : (_gamemaster$data = gamemaster.data) === null || _gamemaster$data === void 0 ? void 0 : _gamemaster$data.moves) || (gamemaster === null || gamemaster === void 0 ? void 0 : gamemaster.combatMoves) || [];\n  for (const m of list) {\n    var _ref, _m$moveId, _ref2, _ref3, _ref4, _m$pvpPower;\n    const id = canonMoveId((_ref = (_m$moveId = m.moveId) !== null && _m$moveId !== void 0 ? _m$moveId : m.id) !== null && _ref !== void 0 ? _ref : m.name);\n    if (!id) continue;\n    const type = String(m.type || m.pokemonType || \"Normal\").replace(/^POKEMON_TYPE_/, \"\").toLowerCase();\n    const power = Number((_ref2 = (_ref3 = (_ref4 = (_m$pvpPower = m.pvpPower) !== null && _m$pvpPower !== void 0 ? _m$pvpPower : m.power) !== null && _ref4 !== void 0 ? _ref4 : m.combatPower) !== null && _ref3 !== void 0 ? _ref3 : m.damage) !== null && _ref2 !== void 0 ? _ref2 : 0) || 0;\n    let energyGain = 0,\n      energyCost = 0,\n      turns = Number(m.turns);\n    if (m.energyDelta != null) {\n      const ed = Number(m.energyDelta) || 0;\n      if (ed > 0) energyGain = ed;\n      if (ed < 0) energyCost = Math.abs(ed);\n    }\n    if (m.energyGain != null) energyGain = Number(m.energyGain) || energyGain;\n    if (m.energy != null) energyCost = Math.abs(Number(m.energy)) || energyCost;\n    if (!Number.isFinite(turns)) turns = energyGain > 0 ? 1 : 0;\n    if (energyGain > 0) turns = Math.max(1, Math.floor(turns) || 1);\n    MOVES[id] = {\n      id,\n      type,\n      power,\n      energyGain,\n      energy: energyCost,\n      turns\n    };\n  }\n  MOVES.TACKLE ||= {\n    id: \"TACKLE\",\n    type: \"normal\",\n    power: 3,\n    energyGain: 8,\n    energy: 0,\n    turns: 1\n  };\n})();\nconst POKEDEX = {},\n  POKEDEX_NORM = {};\n(function buildDex(_gamemaster$data2) {\n  const list = (gamemaster === null || gamemaster === void 0 ? void 0 : gamemaster.pokemon) || (gamemaster === null || gamemaster === void 0 ? void 0 : (_gamemaster$data2 = gamemaster.data) === null || _gamemaster$data2 === void 0 ? void 0 : _gamemaster$data2.pokemon) || [];\n  for (const p of list) {\n    var _ref5, _bs$atk, _ref6, _bs$def, _ref7, _ref8, _bs$hp;\n    if (!(p !== null && p !== void 0 && p.speciesId)) continue;\n    const exact = String(p.speciesId);\n    const norm = normSpecies(exact);\n    const bs = p.baseStats || p.stats || {};\n    const typesArr = p.types || [p.type1, p.type2].filter(Boolean);\n    const types = (typesArr || []).map(t => String(t).replace(/^POKEMON_TYPE_/, \"\").toLowerCase());\n    const entry = {\n      speciesId: exact,\n      types: types.length ? types : [\"normal\"],\n      stats: {\n        atk: Number((_ref5 = (_bs$atk = bs.atk) !== null && _bs$atk !== void 0 ? _bs$atk : bs.attack) !== null && _ref5 !== void 0 ? _ref5 : 0) || 0,\n        def: Number((_ref6 = (_bs$def = bs.def) !== null && _bs$def !== void 0 ? _bs$def : bs.defense) !== null && _ref6 !== void 0 ? _ref6 : 0) || 0,\n        hp: Number((_ref7 = (_ref8 = (_bs$hp = bs.hp) !== null && _bs$hp !== void 0 ? _bs$hp : bs.sta) !== null && _ref8 !== void 0 ? _ref8 : bs.stamina) !== null && _ref7 !== void 0 ? _ref7 : 0) || 0\n      }\n    };\n    POKEDEX[exact] = entry;\n    POKEDEX_NORM[norm] = entry;\n  }\n})();\nconst lookupSpecies = id => POKEDEX[id] || POKEDEX_NORM[normSpecies(id)] || null;\nconst lookupMove = id => id ? MOVES[canonMoveId(id)] || null : null;\n\n/* ---------- type chart ---------- */\nconst TYPES = [\"normal\", \"fighting\", \"flying\", \"poison\", \"ground\", \"rock\", \"bug\", \"ghost\", \"steel\", \"fire\", \"water\", \"grass\", \"electric\", \"psychic\", \"ice\", \"dragon\", \"dark\", \"fairy\"];\nconst EFF = {};\nfor (const a of TYPES) {\n  EFF[a] = {};\n  for (const d of TYPES) EFF[a][d] = 1;\n}\nfunction S(a, ds, m) {\n  for (const d of ds) EFF[a][d] = m;\n}\n_c = S;\nS(\"fighting\", [\"normal\", \"rock\", \"ice\", \"dark\", \"steel\"], 1.6);\nS(\"fighting\", [\"flying\", \"poison\", \"bug\", \"psychic\", \"fairy\"], 0.625);\nS(\"fighting\", [\"ghost\"], 0.390625);\nS(\"flying\", [\"fighting\", \"bug\", \"grass\"], 1.6);\nS(\"flying\", [\"rock\", \"steel\", \"electric\"], 0.625);\nS(\"poison\", [\"grass\", \"fairy\"], 1.6);\nS(\"poison\", [\"poison\", \"ground\", \"rock\", \"ghost\"], 0.625);\nS(\"poison\", [\"steel\"], 0.390625);\nS(\"ground\", [\"poison\", \"rock\", \"steel\", \"fire\", \"electric\"], 1.6);\nS(\"ground\", [\"bug\", \"grass\"], 0.625);\nS(\"ground\", [\"flying\"], 0.390625);\nS(\"rock\", [\"flying\", \"bug\", \"fire\", \"ice\"], 1.6);\nS(\"rock\", [\"fighting\", \"ground\", \"steel\"], 0.625);\nS(\"bug\", [\"grass\", \"psychic\", \"dark\"], 1.6);\nS(\"bug\", [\"fighting\", \"flying\", \"poison\", \"ghost\", \"steel\", \"fire\", \"fairy\"], 0.625);\nS(\"ghost\", [\"ghost\", \"psychic\"], 1.6);\nS(\"ghost\", [\"dark\"], 0.625);\nS(\"ghost\", [\"normal\"], 0.390625);\nS(\"steel\", [\"rock\", \"ice\", \"fairy\"], 1.6);\nS(\"steel\", [\"steel\", \"fire\", \"water\", \"electric\"], 0.625);\nS(\"fire\", [\"bug\", \"steel\", \"grass\", \"ice\"], 1.6);\nS(\"fire\", [\"rock\", \"fire\", \"water\", \"dragon\"], 0.625);\nS(\"water\", [\"ground\", \"rock\", \"fire\"], 1.6);\nS(\"water\", [\"water\", \"grass\", \"dragon\"], 0.625);\nS(\"grass\", [\"ground\", \"rock\", \"water\"], 1.6);\nS(\"grass\", [\"flying\", \"poison\", \"bug\", \"steel\", \"fire\", \"grass\", \"dragon\"], 0.625);\nS(\"electric\", [\"flying\", \"water\"], 1.6);\nS(\"electric\", [\"grass\", \"electric\", \"dragon\"], 0.625);\nS(\"electric\", [\"ground\"], 0.390625);\nS(\"psychic\", [\"fighting\", \"poison\"], 1.6);\nS(\"psychic\", [\"psychic\", \"steel\"], 0.625);\nS(\"psychic\", [\"dark\"], 0.390625);\nS(\"ice\", [\"flying\", \"ground\", \"grass\", \"dragon\"], 1.6);\nS(\"ice\", [\"steel\", \"fire\", \"water\", \"ice\"], 0.625);\nS(\"dragon\", [\"dragon\"], 1.6);\nS(\"dragon\", [\"steel\"], 0.625);\nS(\"dragon\", [\"fairy\"], 0.390625);\nS(\"dark\", [\"ghost\", \"psychic\"], 1.6);\nS(\"dark\", [\"fighting\", \"dark\", \"fairy\"], 0.625);\nS(\"fairy\", [\"fighting\", \"dragon\", \"dark\"], 1.6);\nS(\"fairy\", [\"poison\", \"steel\", \"fire\"], 0.625);\nconst STAB = 1.2;\nfunction effMult(type, defendTypes) {\n  let m = 1;\n  for (const t of defendTypes || []) {\n    var _EFF$type$t, _EFF$type;\n    m *= (_EFF$type$t = (_EFF$type = EFF[type]) === null || _EFF$type === void 0 ? void 0 : _EFF$type[t]) !== null && _EFF$type$t !== void 0 ? _EFF$type$t : 1;\n  }\n  return m;\n}\nfunction pvpDamage(power, atk, def, stab, eff) {\n  const raw = 0.5 * power * (atk / Math.max(1, def)) * (stab || 1) * (eff || 1);\n  return Math.floor(raw) + 1;\n}\n\n/* ---------- battler ---------- */\nfunction makeBattler(src) {\n  const base = lookupSpecies(src === null || src === void 0 ? void 0 : src.speciesId);\n  if (!base) {\n    console.warn(\"Engine: species not found\", src === null || src === void 0 ? void 0 : src.speciesId);\n    return {\n      speciesId: (src === null || src === void 0 ? void 0 : src.speciesId) || \"unknown\",\n      types: [],\n      atk: 0,\n      def: 0,\n      hpMax: 0,\n      hp: 0,\n      shields: (src === null || src === void 0 ? void 0 : src.shields) | 0,\n      energy: 0,\n      fast: MOVES.TACKLE,\n      charged: [],\n      fastTurnsLeft: MOVES.TACKLE.turns || 1\n    };\n  }\n  const fast = lookupMove(src === null || src === void 0 ? void 0 : src.fastMove) || MOVES.TACKLE;\n  const charged = ((src === null || src === void 0 ? void 0 : src.chargedMoves) || []).map(lookupMove).filter(Boolean);\n  const atk = base.stats.atk || 0,\n    def = base.stats.def || 0,\n    hpMax = base.stats.hp || 0;\n  return {\n    speciesId: base.speciesId,\n    types: base.types,\n    atk,\n    def,\n    hpMax,\n    hp: hpMax,\n    shields: Number(src === null || src === void 0 ? void 0 : src.shields) | 0,\n    energy: 0,\n    fast,\n    charged,\n    fastTurnsLeft: fast.turns || 1\n  };\n}\n\n/* ---------- core sim ---------- */\nexport function simulateBattle(p1In, p2In) {\n  const A = makeBattler(p1In);\n  const B = makeBattler(p2In);\n  const MAX_TURNS = 1000;\n  for (let t = 1; t <= MAX_TURNS; t++) {\n    if (A.hp <= 0 || B.hp <= 0) break;\n    const aReady = pickCharged(A, B);\n    const bReady = pickCharged(B, A);\n    if (aReady || bReady) {\n      const first = aReady && bReady ? A.atk === B.atk ? A.speciesId < B.speciesId ? \"A\" : \"B\" : A.atk > B.atk ? \"A\" : \"B\" : aReady ? \"A\" : \"B\";\n      if (first === \"A\") {\n        resolveCharged(A, B, aReady);\n        if (B.hp <= 0) break;\n        if (bReady) resolveCharged(B, A, bReady);\n      } else {\n        resolveCharged(B, A, bReady);\n        if (A.hp <= 0) break;\n        if (aReady) resolveCharged(A, B, aReady);\n      }\n      if (aReady) A.fastTurnsLeft = A.fast.turns || 1;\n      if (bReady) B.fastTurnsLeft = B.fast.turns || 1;\n      continue;\n    }\n    stepFast(A, B);\n    if (B.hp <= 0) break;\n    stepFast(B, A);\n    if (A.hp <= 0) break;\n  }\n  const result = A.hp <= 0 && B.hp <= 0 ? \"draw\" : B.hp <= 0 ? \"p1\" : A.hp <= 0 ? \"p2\" : \"timeout\";\n  return {\n    result,\n    p1: {\n      hp: A.hpMax ? Math.round(A.hp / A.hpMax * 100) : 0,\n      shields: A.shields,\n      energy: A.energy\n    },\n    p2: {\n      hp: B.hpMax ? Math.round(B.hp / B.hpMax * 100) : 0,\n      shields: B.shields,\n      energy: B.energy\n    }\n  };\n}\nfunction pickCharged(me, opp) {\n  const ready = me.charged.filter(m => me.energy >= (m.energy || 999));\n  if (!ready.length) return null;\n  let best = ready[0],\n    bestScore = -1;\n  for (const m of ready) {\n    const d = projDamage(me, opp, m);\n    const score = d + (100 - (m.energy || 100)) * 0.05;\n    if (score > bestScore) {\n      bestScore = score;\n      best = m;\n    }\n  }\n  return best;\n}\nfunction resolveCharged(att, def, move) {\n  if (!move) return;\n  if (def.shields > 0) {\n    def.shields -= 1;\n  } else {\n    def.hp = Math.max(0, def.hp - projDamage(att, def, move));\n  }\n  att.energy = clamp(att.energy - (move.energy || 0), 0, 100);\n}\nfunction stepFast(att, def) {\n  att.fastTurnsLeft -= 1;\n  if (att.fastTurnsLeft <= 0) {\n    def.hp = Math.max(0, def.hp - projDamage(att, def, att.fast));\n    att.energy = clamp(att.energy + (att.fast.energyGain || 0), 0, 100);\n    att.fastTurnsLeft = att.fast.turns || 1;\n  }\n}\nfunction projDamage(att, def, move) {\n  if (!move) return 0;\n  const stab = att.types.includes(move.type) ? STAB : 1;\n  const eff = effMult(move.type, def.types);\n  return pvpDamage(move.power || 0, att.atk, def.def, stab, eff);\n}\nvar _c;\n$RefreshReg$(_c, \"S\");","map":{"version":3,"names":["gamemaster","canonMoveId","s","String","trim","replace","toUpperCase","normSpecies","toLowerCase","clamp","v","lo","hi","Math","max","min","MOVES","buildMoves","_gamemaster$data","list","moves","data","combatMoves","m","_ref","_m$moveId","_ref2","_ref3","_ref4","_m$pvpPower","id","moveId","name","type","pokemonType","power","Number","pvpPower","combatPower","damage","energyGain","energyCost","turns","energyDelta","ed","abs","energy","isFinite","floor","TACKLE","POKEDEX","POKEDEX_NORM","buildDex","_gamemaster$data2","pokemon","p","_ref5","_bs$atk","_ref6","_bs$def","_ref7","_ref8","_bs$hp","speciesId","exact","norm","bs","baseStats","stats","typesArr","types","type1","type2","filter","Boolean","map","t","entry","length","atk","attack","def","defense","hp","sta","stamina","lookupSpecies","lookupMove","TYPES","EFF","a","d","S","ds","_c","STAB","effMult","defendTypes","_EFF$type$t","_EFF$type","pvpDamage","stab","eff","raw","makeBattler","src","base","console","warn","hpMax","shields","fast","charged","fastTurnsLeft","fastMove","chargedMoves","simulateBattle","p1In","p2In","A","B","MAX_TURNS","aReady","pickCharged","bReady","first","resolveCharged","stepFast","result","p1","round","p2","me","opp","ready","best","bestScore","projDamage","score","att","move","includes","$RefreshReg$"],"sources":["C:/Users/ben/Projects/nebsojipvptrainer/src/engine/battleEngine.js"],"sourcesContent":["// /src/engine/battleEngine.js\r\n// Robust PvP-lite engine (never crashes on bad IDs). Returns:\r\n// { result:'p1'|'p2'|'draw'|'timeout', p1:{hp,shields,energy}, p2:{hp,shields,energy} }\r\n\r\nimport gamemaster from \"../Data/gamemaster.json\";\r\n\r\n/* ---------- normalization ---------- */\r\nfunction canonMoveId(s) {\r\n    return String(s || \"\")\r\n        .trim()\r\n        .replace(/^COMBAT_V\\d+_MOVE_/i, \"\")\r\n        .replace(/^V\\d+_/i, \"\")\r\n        .replace(/[^A-Za-z0-9]+/g, \"_\")\r\n        .replace(/_+/g, \"_\")\r\n        .replace(/^_|_$/g, \"\")\r\n        .toUpperCase();\r\n}\r\nfunction normSpecies(s) {\r\n    return String(s || \"\")\r\n        .toLowerCase()\r\n        .trim()\r\n        .replace(/[^a-z0-9]+/g, \"_\")\r\n        .replace(/^_+|_+$/g, \"\");\r\n}\r\nconst clamp = (v, lo, hi) => Math.max(lo, Math.min(hi, v));\r\n\r\n/* ---------- build data maps ---------- */\r\nconst MOVES = {};\r\n(function buildMoves() {\r\n    const list = gamemaster?.moves || gamemaster?.data?.moves || gamemaster?.combatMoves || [];\r\n    for (const m of list) {\r\n        const id = canonMoveId(m.moveId ?? m.id ?? m.name);\r\n        if (!id) continue;\r\n        const type = String(m.type || m.pokemonType || \"Normal\").replace(/^POKEMON_TYPE_/, \"\").toLowerCase();\r\n        const power = Number(m.pvpPower ?? m.power ?? m.combatPower ?? m.damage ?? 0) || 0;\r\n        let energyGain = 0, energyCost = 0, turns = Number(m.turns);\r\n        if (m.energyDelta != null) {\r\n            const ed = Number(m.energyDelta) || 0;\r\n            if (ed > 0) energyGain = ed;\r\n            if (ed < 0) energyCost = Math.abs(ed);\r\n        }\r\n        if (m.energyGain != null) energyGain = Number(m.energyGain) || energyGain;\r\n        if (m.energy != null) energyCost = Math.abs(Number(m.energy)) || energyCost;\r\n        if (!Number.isFinite(turns)) turns = energyGain > 0 ? 1 : 0;\r\n        if (energyGain > 0) turns = Math.max(1, Math.floor(turns) || 1);\r\n        MOVES[id] = { id, type, power, energyGain, energy: energyCost, turns };\r\n    }\r\n    MOVES.TACKLE ||= { id: \"TACKLE\", type: \"normal\", power: 3, energyGain: 8, energy: 0, turns: 1 };\r\n})();\r\n\r\nconst POKEDEX = {}, POKEDEX_NORM = {};\r\n(function buildDex() {\r\n    const list = gamemaster?.pokemon || gamemaster?.data?.pokemon || [];\r\n    for (const p of list) {\r\n        if (!p?.speciesId) continue;\r\n        const exact = String(p.speciesId);\r\n        const norm = normSpecies(exact);\r\n        const bs = p.baseStats || p.stats || {};\r\n        const typesArr = p.types || [p.type1, p.type2].filter(Boolean);\r\n        const types = (typesArr || []).map(t => String(t).replace(/^POKEMON_TYPE_/, \"\").toLowerCase());\r\n        const entry = {\r\n            speciesId: exact,\r\n            types: types.length ? types : [\"normal\"],\r\n            stats: {\r\n                atk: Number(bs.atk ?? bs.attack ?? 0) || 0,\r\n                def: Number(bs.def ?? bs.defense ?? 0) || 0,\r\n                hp: Number(bs.hp ?? bs.sta ?? bs.stamina ?? 0) || 0\r\n            }\r\n        };\r\n        POKEDEX[exact] = entry;\r\n        POKEDEX_NORM[norm] = entry;\r\n    }\r\n})();\r\nconst lookupSpecies = (id) => (POKEDEX[id] || POKEDEX_NORM[normSpecies(id)] || null);\r\nconst lookupMove = (id) => (id ? MOVES[canonMoveId(id)] || null : null);\r\n\r\n/* ---------- type chart ---------- */\r\nconst TYPES = [\"normal\", \"fighting\", \"flying\", \"poison\", \"ground\", \"rock\", \"bug\", \"ghost\", \"steel\", \"fire\", \"water\", \"grass\", \"electric\", \"psychic\", \"ice\", \"dragon\", \"dark\", \"fairy\"];\r\nconst EFF = {}; for (const a of TYPES) { EFF[a] = {}; for (const d of TYPES) EFF[a][d] = 1; }\r\nfunction S(a, ds, m) { for (const d of ds) EFF[a][d] = m; }\r\nS(\"fighting\", [\"normal\", \"rock\", \"ice\", \"dark\", \"steel\"], 1.6); S(\"fighting\", [\"flying\", \"poison\", \"bug\", \"psychic\", \"fairy\"], 0.625); S(\"fighting\", [\"ghost\"], 0.390625);\r\nS(\"flying\", [\"fighting\", \"bug\", \"grass\"], 1.6); S(\"flying\", [\"rock\", \"steel\", \"electric\"], 0.625);\r\nS(\"poison\", [\"grass\", \"fairy\"], 1.6); S(\"poison\", [\"poison\", \"ground\", \"rock\", \"ghost\"], 0.625); S(\"poison\", [\"steel\"], 0.390625);\r\nS(\"ground\", [\"poison\", \"rock\", \"steel\", \"fire\", \"electric\"], 1.6); S(\"ground\", [\"bug\", \"grass\"], 0.625); S(\"ground\", [\"flying\"], 0.390625);\r\nS(\"rock\", [\"flying\", \"bug\", \"fire\", \"ice\"], 1.6); S(\"rock\", [\"fighting\", \"ground\", \"steel\"], 0.625);\r\nS(\"bug\", [\"grass\", \"psychic\", \"dark\"], 1.6); S(\"bug\", [\"fighting\", \"flying\", \"poison\", \"ghost\", \"steel\", \"fire\", \"fairy\"], 0.625);\r\nS(\"ghost\", [\"ghost\", \"psychic\"], 1.6); S(\"ghost\", [\"dark\"], 0.625); S(\"ghost\", [\"normal\"], 0.390625);\r\nS(\"steel\", [\"rock\", \"ice\", \"fairy\"], 1.6); S(\"steel\", [\"steel\", \"fire\", \"water\", \"electric\"], 0.625);\r\nS(\"fire\", [\"bug\", \"steel\", \"grass\", \"ice\"], 1.6); S(\"fire\", [\"rock\", \"fire\", \"water\", \"dragon\"], 0.625);\r\nS(\"water\", [\"ground\", \"rock\", \"fire\"], 1.6); S(\"water\", [\"water\", \"grass\", \"dragon\"], 0.625);\r\nS(\"grass\", [\"ground\", \"rock\", \"water\"], 1.6); S(\"grass\", [\"flying\", \"poison\", \"bug\", \"steel\", \"fire\", \"grass\", \"dragon\"], 0.625);\r\nS(\"electric\", [\"flying\", \"water\"], 1.6); S(\"electric\", [\"grass\", \"electric\", \"dragon\"], 0.625); S(\"electric\", [\"ground\"], 0.390625);\r\nS(\"psychic\", [\"fighting\", \"poison\"], 1.6); S(\"psychic\", [\"psychic\", \"steel\"], 0.625); S(\"psychic\", [\"dark\"], 0.390625);\r\nS(\"ice\", [\"flying\", \"ground\", \"grass\", \"dragon\"], 1.6); S(\"ice\", [\"steel\", \"fire\", \"water\", \"ice\"], 0.625);\r\nS(\"dragon\", [\"dragon\"], 1.6); S(\"dragon\", [\"steel\"], 0.625); S(\"dragon\", [\"fairy\"], 0.390625);\r\nS(\"dark\", [\"ghost\", \"psychic\"], 1.6); S(\"dark\", [\"fighting\", \"dark\", \"fairy\"], 0.625);\r\nS(\"fairy\", [\"fighting\", \"dragon\", \"dark\"], 1.6); S(\"fairy\", [\"poison\", \"steel\", \"fire\"], 0.625);\r\n\r\nconst STAB = 1.2;\r\nfunction effMult(type, defendTypes) { let m = 1; for (const t of (defendTypes || [])) m *= (EFF[type]?.[t] ?? 1); return m; }\r\nfunction pvpDamage(power, atk, def, stab, eff) { const raw = 0.5 * power * (atk / Math.max(1, def)) * (stab || 1) * (eff || 1); return Math.floor(raw) + 1; }\r\n\r\n/* ---------- battler ---------- */\r\nfunction makeBattler(src) {\r\n    const base = lookupSpecies(src?.speciesId);\r\n    if (!base) {\r\n        console.warn(\"Engine: species not found\", src?.speciesId);\r\n        return { speciesId: src?.speciesId || \"unknown\", types: [], atk: 0, def: 0, hpMax: 0, hp: 0, shields: src?.shields | 0, energy: 0, fast: MOVES.TACKLE, charged: [], fastTurnsLeft: MOVES.TACKLE.turns || 1 };\r\n    }\r\n    const fast = lookupMove(src?.fastMove) || MOVES.TACKLE;\r\n    const charged = (src?.chargedMoves || []).map(lookupMove).filter(Boolean);\r\n    const atk = base.stats.atk || 0, def = base.stats.def || 0, hpMax = base.stats.hp || 0;\r\n\r\n    return {\r\n        speciesId: base.speciesId,\r\n        types: base.types,\r\n        atk, def, hpMax, hp: hpMax,\r\n        shields: Number(src?.shields) | 0,\r\n        energy: 0,\r\n        fast, charged,\r\n        fastTurnsLeft: fast.turns || 1\r\n    };\r\n}\r\n\r\n/* ---------- core sim ---------- */\r\nexport function simulateBattle(p1In, p2In) {\r\n    const A = makeBattler(p1In);\r\n    const B = makeBattler(p2In);\r\n\r\n    const MAX_TURNS = 1000;\r\n    for (let t = 1; t <= MAX_TURNS; t++) {\r\n        if (A.hp <= 0 || B.hp <= 0) break;\r\n\r\n        const aReady = pickCharged(A, B);\r\n        const bReady = pickCharged(B, A);\r\n\r\n        if (aReady || bReady) {\r\n            const first = (aReady && bReady)\r\n                ? (A.atk === B.atk ? (A.speciesId < B.speciesId ? \"A\" : \"B\") : (A.atk > B.atk ? \"A\" : \"B\"))\r\n                : (aReady ? \"A\" : \"B\");\r\n\r\n            if (first === \"A\") { resolveCharged(A, B, aReady); if (B.hp <= 0) break; if (bReady) resolveCharged(B, A, bReady); }\r\n            else { resolveCharged(B, A, bReady); if (A.hp <= 0) break; if (aReady) resolveCharged(A, B, aReady); }\r\n\r\n            if (aReady) A.fastTurnsLeft = A.fast.turns || 1;\r\n            if (bReady) B.fastTurnsLeft = B.fast.turns || 1;\r\n            continue;\r\n        }\r\n\r\n        stepFast(A, B); if (B.hp <= 0) break;\r\n        stepFast(B, A); if (A.hp <= 0) break;\r\n    }\r\n\r\n    const result = (A.hp <= 0 && B.hp <= 0) ? \"draw\" : (B.hp <= 0 ? \"p1\" : (A.hp <= 0 ? \"p2\" : \"timeout\"));\r\n    return {\r\n        result,\r\n        p1: { hp: A.hpMax ? Math.round((A.hp / A.hpMax) * 100) : 0, shields: A.shields, energy: A.energy },\r\n        p2: { hp: B.hpMax ? Math.round((B.hp / B.hpMax) * 100) : 0, shields: B.shields, energy: B.energy }\r\n    };\r\n}\r\n\r\nfunction pickCharged(me, opp) {\r\n    const ready = me.charged.filter(m => me.energy >= (m.energy || 999));\r\n    if (!ready.length) return null;\r\n    let best = ready[0], bestScore = -1;\r\n    for (const m of ready) {\r\n        const d = projDamage(me, opp, m);\r\n        const score = d + (100 - (m.energy || 100)) * 0.05;\r\n        if (score > bestScore) { bestScore = score; best = m; }\r\n    }\r\n    return best;\r\n}\r\nfunction resolveCharged(att, def, move) {\r\n    if (!move) return;\r\n    if (def.shields > 0) { def.shields -= 1; }\r\n    else { def.hp = Math.max(0, def.hp - projDamage(att, def, move)); }\r\n    att.energy = clamp(att.energy - (move.energy || 0), 0, 100);\r\n}\r\nfunction stepFast(att, def) {\r\n    att.fastTurnsLeft -= 1;\r\n    if (att.fastTurnsLeft <= 0) {\r\n        def.hp = Math.max(0, def.hp - projDamage(att, def, att.fast));\r\n        att.energy = clamp(att.energy + (att.fast.energyGain || 0), 0, 100);\r\n        att.fastTurnsLeft = att.fast.turns || 1;\r\n    }\r\n}\r\nfunction projDamage(att, def, move) {\r\n    if (!move) return 0;\r\n    const stab = att.types.includes(move.type) ? STAB : 1;\r\n    const eff = effMult(move.type, def.types);\r\n    return pvpDamage(move.power || 0, att.atk, def.def, stab, eff);\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}